#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative "includes/packages"

#
# ~/.dotfiles/bin/install
# Installation script for new machines (Mac OS)
#
class Install
  include Packages

  def initialize
    setup
    install_packages
    install_spacemacs
    install_emacs_private
    install_skeletons
    copy_dotfiles
  end

  def setup
    `xcode-select --install`
    `brew tap homebrew/versions`
    `brew update`
    `sudo easy_install pip`
    `sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"`
  end

  def install_packages
    Packages::BREWS.each { |package| `brew install #{package}` }
    Packages::CASKS.each { |package| `brew cask install #{package}` }
    Packages::YARNS.each { |package| `yarn global add #{package}` }
    Packages::PIPS.each  { |package| `pip install #{package}` }
  end

  def install_spacemacs
    `brew tap d12frosted/emacs-plus`
    `brew install emacs-plus --HEAD --with-natural-title-bars`
    `brew linkapps emacs-plus`
    `git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d`
  end

  def install_emacs_private
    `git clone git@github.com:AndrewMcBurney/emacs.d.git ~/.emacs.d/private/`
    `git clone git@github.com:AndrewMcBurney/emacs.d.git ~/.emacs.d/private/emerald`
    `git clone git@github.com:juanedi/crystal-spacemacs-layer.git ~/.emacs.d/private/crystal`
  end

  def install_skeletons
    %w[
      express-pug-sass-ts
      rails-es6
      ruby-cli-activerecord
      sinatra-slim-sass-coffee
    ].each do
      `git clone git@github.com:AndrewMcBurney/#{skeleton}.git ~/.emacs.d/private/skeletons/#{skeleton}`
    end
  end

  def copy_dotfiles
    `cp ~/.dotfiles/emacs/.spacemacs/ ~/.spacemacs`
    `cp ~/.dotfiles/vim/.vimrc ~/.vimrc`
    `cp ~/.dotfiles/zsh/.zshrc ~/.zshrc`
  end
end

Install.new
