#!/usr/bin/env ruby

## dev-port
#
#  Author: Andrew Robert McBurney <andrewrobertmcburney@gmail.com>
#  Description: Forwards a port from my workstation to my local machine.
#  Usage:
#
#    dev-port <source_port> <optional:dest_port>

Dir[File.join(__dir__, "shared", "*.rb")].each { |file| require file }

def ssh_forward_port!(source, dest)
  system("ssh -i #{PEM_FILE_PATH} #{WORKSTATION} -N -L #{source}:localhost:#{dest}")
end

Error.not_enough_arguments(1) if ARGV.size.zero?

source_port = ARGV[0]
dest_port   = ARGV[1] || source_port

ssh_forward_port!(source_port, dest_port)
